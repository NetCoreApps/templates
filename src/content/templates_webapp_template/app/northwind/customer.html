<!--
title: Customer Details
-->

<a id="back" href="javascript:history.back()">&#8592; Back</a>

{{ id | endIfEmpty | use("select * from Customer where Id = @id") | dbSingle({ id }) | assignTo: customer }}

{{ id | endIfEmpty | useFmt(
    'select o.Id, 
           {0} Employee, 
           OrderDate, ShipCountry, ShippedDate, 
           {1} Total 
      from {2} o
           inner join
           OrderDetail d on o.Id = d.OrderId
           inner join 
           Employee e on o.EmployeeId = e.Id
     where CustomerId = @id
     group by o.Id, EmployeeId, FirstName, LastName, OrderDate, ShipCountry, ShippedDate',
     sqlConcat(["e.FirstName", "' '", "e.LastName"]), sqlCurrency("sum((d.Unitprice * d.Quantity) - d.discount)"), sqlQuote("Order"))
   | dbSelect({ id }) | assignTo: orders }}

{{ { customer, orders }   | ifExists(customer) | selectPartial: customer-details }}
{{ customer | endIfExists | useFmt("No Customer has id: {0}", id) }}

{{ `<script>
$("form select:first").focus();
$('.details tbody tr').on('click', function(){
    var id = $(this).find("td:first").html();
    location.href = 'order?id=' + id;
})
</script>` | appendTo: scripts }}
